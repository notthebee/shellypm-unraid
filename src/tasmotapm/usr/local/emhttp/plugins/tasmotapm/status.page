Menu="Dashboard"
Icon="ups"
---
<style type="text/css">
    <?php
        $tasmotapm_cfg = parse_plugin_cfg("tasmotapm",true);
        $sortnr = $N+2
    ?>
    #dash_tasmotapm_settings i, #tasmotapm_view {margin-top:0px;}
</style>
<table id='db-box1' class='dash_tasmotapm dashboard box1' style="display:none">
    <thead sort='<?=$sortnr?>'>
	    <tr class='hidden'>
		    <td></td>
		    <td colspan='3'></td>
		<td></td>
	    </tr>
    </thead>
    <tbody sort='<?=$sortnr?>' class='sortable'>
	    <tr>
		    <td></td>
		    <td colspan='3' class='next'>
                <i class='icon-ups'></i>
                <div class='section'>_(Shelly Power Monitor)_<br><span id='load'>_(Usage)_: <span class='tasmotapm-energy-power'>0</span> W</span><br><br></div>
                <i class='fa fa-fw chevron' id='tasmotapm_view' onclick='toggleChevron("tasmotapm_view",0)'></i>
                <a href='/Settings/TasmotaPMSettings' title="_(Go to Tasmota Power Monitor settings)_"><i class='fa fa-fw fa-cog chevron'></i></a>
            </td>
            <td></td>
        </tr>
    </tbody>
</table>
<script>
const tasmotapm_status = () => {
    $.getJSON("/plugins/tasmotapm/status.php", (data) => {
        if (data) {
            $(".tasmotapm-energy-power").html(data.Power);
        }
    });
};
$(tasmotapm_status);
if (<?=$tasmotapm_cfg['UIREFRESH'];?>) {
    setInterval(tasmotapm_status, <?=$tasmotapm_cfg['UIREFRESH'];?>);
}
$(function() {
  // append data from the table into the correct one
  $("#db-box1").append($(".dash_tasmotapm").html());
  
  // reload toggle to get the correct state
  toggleView('tasmotapm_view',true);
  
  // reload sorting to get the stored data (cookie)
  sortTable($('#db-box1'),$.cookie('db-box1'));
});
</script>
